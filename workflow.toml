version = 2

[outbox]
backend = "sqlite"
path = "state/outbox.sqlite"

[workdir]
enabled = true
backend = "git-worktree"
root = "/.worktrees/runs"
cleanup = "immediate"
roles = ["backend"]

[approval]
mode = "any"
approvers = ["lead-backend", "lead-reviewer", "lead-qa", "lead-integrator"]

[roles]
enabled = ["backend", "reviewer", "qa", "integrator", "recorder"]

[repos]
main = "."

[role_repo]
backend = "main"
reviewer = "main"
qa = "main"
integrator = "main"
recorder = "main"

[labels]
routing = ["to:backend", "to:reviewer", "to:qa", "to:integrator", "to:recorder"]
states = ["state:todo", "state:doing", "state:blocked", "state:review", "state:done"]
decisions = ["decision:proposed", "decision:accepted", "decision:rejected"]
controls = ["needs-human", "autoflow:off"]
types = ["kind:task", "kind:bug", "kind:question", "kind:proposal", "kind:blocker"]
priority = ["prio:p0", "prio:p1", "prio:p2", "prio:p3"]
review = ["review:approved", "review:changes_requested"]
qa = ["qa:pass", "qa:fail"]

[groups.backend]
role = "backend"
max_concurrent = 4
mode = "owner"
writeback = "full"
listen_labels = ["to:backend"]

[groups.reviewer]
role = "reviewer"
max_concurrent = 1
mode = "subscriber"
writeback = "comment-only"
listen_labels = ["to:reviewer", "state:review"]

[groups.qa]
role = "qa"
max_concurrent = 2
mode = "subscriber"
writeback = "comment-only"
listen_labels = ["to:qa", "state:review"]

[groups.integrator]
role = "integrator"
max_concurrent = 1
mode = "owner"
writeback = "full"
listen_labels = ["to:integrator", "state:review"]

[groups.recorder]
role = "recorder"
max_concurrent = 1
mode = "subscriber"
writeback = "comment-only"
listen_labels = ["to:recorder"]

[flow]
require_claim_before_work = true
close_issue_requires_decision = true
auto_block_when_dependency_open = true
auto_unblock_when_dependency_closed = true

[executors.backend]
program = "go"
args = ["test", "./..."]
timeout_seconds = 1800

[executors.reviewer]
program = "go"
args = ["test", "./..."]
timeout_seconds = 1800
